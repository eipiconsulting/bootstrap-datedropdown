<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Refactored date examples</title>


    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.js"></script>
    <script src="bootstrap-datedropdown.js"></script>

    <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.11.0.css">
    <script src="http://code.jquery.com/qunit/qunit-1.11.0.js""></script>

    <script type="text/javascript" charset="utf-8">
      var options = {
        defaultChoice: 2,
        valueChange: function(val){ console.log("new value: " + val); },
        choices: [
          {
            type: "constant",
            label: "My Birthday",
            value: "2/19/1988",
          },
          {
            type: "constant",
            label: "George Washington's Birthday",
            value: new Date(1732, 1, 22),
          },
          {
            type: "pickDate",
            label: "Pick a Date (mm/dd/yyyy)",
          },
          {
            type: "yearsAfter",
            label: "Age in Years",
            origin: "2/19/1988",
          },
          {
            type: "yearsAfter",
            label: "George's Age",
            origin: new Date(1732, 2, 22),
          },
          {
            type: "function",
            label: "Decades after WW2",
            textToDate: function(text) {
              var ww2date = new Date(1939, 9, 1);
              var decades = Number(text);
              ww2date.setYear(ww2date.getFullYear() + decades*10);
              return ww2date;
            },
            dateToText: function(date) {
              var ww2date = new Date(1939, 9, 1);
              return String((date.getFullYear() - ww2date.getFullYear())/10);
            }
          },
        ]
      };
    </script>

    <script>
      $(function(){
        var $dd;
        var $input;
        module('Date Dropdown', {
          setup: function() {
            $dd = $('.date-dropdown')
            .empty()
            .data({})
            .dateDropdown(options);
            $input = $dd.find('input');
          }, 
        });


        test("valHook functionality", function() {
          var $emptyDiv = $('.empty-div');
          equal($emptyDiv.val(), "");
          $dd.val('2/2/2010');
          equal($dd.val(), '2/2/2010');
          $.valHooks.div = {
            set: function(elem, val) {
              $(elem).data('test', val);
              return $(elem);
            },
            get: function(elem) {
              return $(elem).data('test');
            }
          };
          // setup again since first valHook overwrote this
          $dd.empty().dateDropdown(options);
          $emptyDiv.val('123');
          equal($emptyDiv.val(), '123');
          $dd.val('2/2/2010');
          equal($dd.val(), '2/2/2010');
        });


        test('Date to Input Text', function(){
          equal($dd.dateDropdown(0).val(), '2/19/1988');
          equal($input.val(), '2/19/1988');
          equal($dd.dateDropdown(1).val(), '2/22/1732');
          equal($input.val(), '2/22/1732');
          equal($dd.dateDropdown(2).val(), '2/22/1732');
          equal($input.val(), '2/22/1732');
          equal($dd.dateDropdown(3).val(), '2/22/1732');
          equal($input.val(), (1732 - 1988.0).toString());
          equal($dd.dateDropdown(4).val(), '2/22/1732');
          equal($input.val(), (1732 - 1732).toString());
          equal($dd.dateDropdown(5).val(), '2/22/1732');
          equal($input.val(), "-20.7");
        });


        test('Changing The Value', function(){
          $dd.dateDropdown(2)
          .val('2/19/1988');
          equal($dd.val(), '2/19/1988');
          $dd.val('2/19/1989')
          $dd.dateDropdown(3);
          equal($input.val(), '1');
        });

        test('Change listeners', function(){
          // test input change listener
          $dd.dateDropdown(0);
          equal($dd.val(), '2/19/1988');
          $dd.dateDropdown(3);
          $input.val(String(Number($input.val() + 1)))
          .change();
          equal($dd.val(), '2/19/1989');

          // test dropdown click listener
         $dd.find('li:eq(1)').click();
         equal($dd.val(), '2/22/1732');
        });

      });
    </script>
  </head>
  <body>

    <br />
    <div class="row">
      <div class="span4">
        <div class="date-dropdown span2"></div>
        <div class="empty-div"></div>
      </div>
    </div>
    <br />

    <div id="qunit"></div>
    <div id="qunit-fixture"></div>
    
  </body>
</html>
